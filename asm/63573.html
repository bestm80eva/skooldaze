<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Skool Daze: Routine at 63573</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../sd.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Skool Daze" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63488.html">63488</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63573">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63666.html">63666</a></span></td>
</tr>
</table>
<div class="description">63573: Generate a safe combination code and set MR CREAK's birth year</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="63668.html">63668</a>. Generates a new safe combination code, sets a new random birth year for MR CREAK, and adjusts the game mode (so that all the shields need to be flashed again).
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">0</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63573"></a>63573</td>
<td class="instruction">LD HL,32696</td>
<td class="comment-11" rowspan="5">Clear the safe combination code (stored at <a class="link" href="32671.html">32671</a>), the teachers' combination letters (stored at <a class="link" href="32675.html">32675</a>), and the blackboard contents buffers (at <a class="link" href="32680.html">32680</a>, <a class="link" href="32686.html">32686</a> and <a class="link" href="32692.html">32692</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63576"></a>63576</td>
<td class="instruction">LD B,25</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63578"></a>63578</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63579"></a>63579</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63580"></a>63580</td>
<td class="instruction">DJNZ 63578</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63582"></a>63582</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="2"><span class="register">DE</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63583"></a>63583</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63584"></a>63584</td>
<td class="instruction">LD C,4</td>
<td class="comment-11" rowspan="1">There are four letters in the combination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63586"></a>63586</td>
<td class="instruction">CALL <a class="link" href="24993.html">24993</a></td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63589"></a>63589</td>
<td class="instruction">AND 15</td>
<td class="comment-11" rowspan="1">0&lt;=<span class="register">A</span>&lt;=15</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63591"></a>63591</td>
<td class="instruction">JR 63612</td>
<td class="comment-11" rowspan="1">Store MR WACKER's safe combination letter first (at <a class="link" href="32671.html">32671</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63593"></a>63593</td>
<td class="instruction">LD L,159</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a class="link" href="32671.html">32671</a> (first letter of the safe combination code)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63595"></a>63595</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a class="link" href="32671.html">32671</a>+<span class="register">C</span> (1&lt;=<span class="register">C</span>&lt;=3)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63596"></a>63596</td>
<td class="instruction">CALL <a class="link" href="24993.html">24993</a></td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63599"></a>63599</td>
<td class="instruction">LD E,B</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63600"></a>63600</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="4">Get a random number between 0 and 3 in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63601"></a>63601</td>
<td class="instruction">RL E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63603"></a>63603</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63604"></a>63604</td>
<td class="instruction">RL E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63606"></a>63606</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="2">Is <span class="register">A</span> between 0 and 25?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63608"></a>63608</td>
<td class="instruction">CP 26</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63610"></a>63610</td>
<td class="instruction">JR NC,63596</td>
<td class="comment-11" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63612"></a>63612</td>
<td class="instruction">ADD A,65</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ASCII code of an upper case letter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63614"></a>63614</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Store this in one of the slots at <a class="link" href="32671.html">32671</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63615"></a>63615</td>
<td class="instruction">LD L,163</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at a random teacher's safe combination letter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63617"></a>63617</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63618"></a>63618</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-11" rowspan="1">Has this letter already been decided?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63620"></a>63620</td>
<td class="instruction">JR NZ,63593</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63622"></a>63622</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Store the ASCII code in one of the four slots at <a class="link" href="32675.html">32675</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63623"></a>63623</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Next combination letter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63624"></a>63624</td>
<td class="instruction">JR NZ,63593</td>
<td class="comment-11" rowspan="1">Jump back until all four combination letters are done</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63626"></a>
<div class="comments">
<div class="paragraph">
The safe combination code has been generated. Now for MR CREAK's birth year.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63626"></a>63626</td>
<td class="instruction">LD L,154</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a class="link" href="32666.html">32666</a> (which holds the identifier for CREAK's birth year battle)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63628"></a>63628</td>
<td class="instruction">CALL <a class="link" href="24993.html">24993</a></td>
<td class="comment-11" rowspan="3">Get a random number between 0 and 20 in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63631"></a>63631</td>
<td class="instruction">CP 21</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63633"></a>63633</td>
<td class="instruction">JR NC,63628</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63635"></a>63635</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=random odd number between 213 and 253</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63636"></a>63636</td>
<td class="instruction">ADD A,213</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63638"></a>63638</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Store this battle identifier at <a class="link" href="32666.html">32666</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63639"></a>63639</td>
<td class="instruction">SUB 129</td>
<td class="comment-11" rowspan="12">Set <span class="register">HL</span> to the address of the battle year message corresponding to this battle identifier</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63641"></a>63641</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63642"></a>63642</td>
<td class="instruction">LD H,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63643"></a>63643</td>
<td class="instruction">LD L,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63644"></a>63644</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63645"></a>63645</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63646"></a>63646</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63647"></a>63647</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63648"></a>63648</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63649"></a>63649</td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63650"></a>63650</td>
<td class="instruction">ADD A,223</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63652"></a>63652</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63653"></a>63653</td>
<td class="instruction">LD DE,32667</td>
<td class="comment-11" rowspan="3">Store the digits of CREAK's birth year at <a class="link" href="32667.html">32667</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63656"></a>63656</td>
<td class="instruction">LD C,4</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63658"></a>63658</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63660"></a>
<div class="comments">
<div class="paragraph">
Finally, adjust the game mode.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63660"></a>63660</td>
<td class="instruction">LD A,1</td>
<td class="comment-11" rowspan="2">Set the game mode indicator at <a class="link" href="32746.html">32746</a> to 1, indicating that the shields need to be flashed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63662"></a>63662</td>
<td class="instruction">LD (32746),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63665"></a>63665</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63488.html">63488</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63573">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63666.html">63666</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Skool Daze RAM disassembly 20150413</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd (Skool Daze). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>
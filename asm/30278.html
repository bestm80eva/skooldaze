<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Skool Daze: Routine at 30278</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../skool.css" />
<link rel="stylesheet" type="text/css" href="../sd.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30276.html">30276</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30278">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="30406.html">30406</a></span></td>
</tr>
</table>
<div class="description">30278: Generate graphic data for a number</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="30408.html">30408</a> and <a class="link" href="30432.html">30432</a>. Generates a 7x24-bit graphic for the digits of the number in <span class="register">DE</span>, and stores it in the buffer at <a class="link" href="55552.html#55563">55563</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Number</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30278"></a>30278</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30279"></a>30279</td>
<td class="instruction">LD HL,55583</td>
<td class="comment-11" rowspan="6">Blank out the 32-byte buffer at <a class="link" href="55552.html">55552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30282"></a>30282</td>
<td class="instruction">XOR A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30283"></a>30283</td>
<td class="instruction">LD B,31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30285"></a>30285</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30286"></a>30286</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30287"></a>30287</td>
<td class="instruction">DJNZ 30285</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30289"></a>30289</td>
<td class="instruction">LD A,48</td>
<td class="comment-11" rowspan="1">48 is the ASCII code for '0' (zero)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30291"></a>30291</td>
<td class="instruction">LD BC,55536</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-10000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30294"></a>30294</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=the number, <span class="register">DE</span>=<a class="link" href="55552.html">55552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30295"></a>30295</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Subtract 10000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30296"></a>30296</td>
<td class="instruction">JR C,30325</td>
<td class="comment-11" rowspan="1">Jump if the number is &gt; 10000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30298"></a>30298</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Add the 10000 back on</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30300"></a>30300</td>
<td class="instruction">LD BC,64536</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-1000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30303"></a>30303</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Subtract 1000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30304"></a>30304</td>
<td class="instruction">JR C,30338</td>
<td class="comment-11" rowspan="1">Jump if the number is &gt; 1000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30306"></a>30306</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Add the 1000 back on</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30308"></a>30308</td>
<td class="instruction">LD BC,65436</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-100</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30311"></a>30311</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Subtract 100</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30312"></a>30312</td>
<td class="instruction">JR C,30351</td>
<td class="comment-11" rowspan="1">Jump if the number is &gt; 100</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30314"></a>30314</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Add the 100 back on</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30316"></a>30316</td>
<td class="instruction">LD C,246</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30318"></a>30318</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Subtract 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30319"></a>30319</td>
<td class="instruction">JR C,30363</td>
<td class="comment-11" rowspan="1">Jump if the number is &gt; 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30321"></a>30321</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Add the 10 back on</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30323"></a>30323</td>
<td class="instruction">JR 30371</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="30325"></a>
<div class="comments">
<div class="paragraph">
We get here if the number is &gt;= 10000.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30325"></a>30325</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="3">Perform trial subtractions of 10000 and get the ASCII code for the 10000s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30326"></a>30326</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30327"></a>30327</td>
<td class="instruction">JR C,30325</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30329"></a>30329</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30331"></a>30331</td>
<td class="instruction">LD BC,64536</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-1000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30334"></a>30334</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Store the ASCII code for the 10000s digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30335"></a>30335</td>
<td class="instruction">LD A,47</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30337"></a>30337</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30338"></a>30338</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="3">Perform trial subtractions of 1000 and get the ASCII code for the 1000s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30339"></a>30339</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30340"></a>30340</td>
<td class="instruction">JR C,30338</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30342"></a>30342</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30344"></a>30344</td>
<td class="instruction">LD BC,65436</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-100</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30347"></a>30347</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Store the ASCII code for the 1000s digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30348"></a>30348</td>
<td class="instruction">LD A,47</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30350"></a>30350</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30351"></a>30351</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="3">Perform trial subtractions of 100 and get the ASCII code for the 100s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30352"></a>30352</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30353"></a>30353</td>
<td class="instruction">JR C,30351</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30355"></a>30355</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30357"></a>30357</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Store the ASCII code for the 100s digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30358"></a>30358</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30359"></a>30359</td>
<td class="instruction">LD C,246</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span>=-10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30361"></a>30361</td>
<td class="instruction">LD A,47</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30363"></a>30363</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="3">Perform trial subtractions of 10 and get the ASCII code for the 10s digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30364"></a>30364</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30365"></a>30365</td>
<td class="instruction">JR C,30363</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30367"></a>30367</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-11" rowspan="1">Undo the last trial subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30369"></a>30369</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Store the ASCII code for the 10s digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30370"></a>30370</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30371"></a>30371</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="2">Get the ASCII code for the units digit in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30372"></a>30372</td>
<td class="instruction">ADD A,48</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30374"></a>30374</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Store the ASCII code for the units digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30375"></a>30375</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30376"></a>30376</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Move along in the buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30377"></a>30377</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Mark the end of the number string with a 0 byte</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="30378"></a>
<div class="comments">
<div class="paragraph">
Now that the ASCII codes for the digits of the number have been calculated and stored at <a class="link" href="55552.html">55552</a>, generate the corresponding graphic data.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30378"></a>30378</td>
<td class="instruction">LD E,0</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=<a class="link" href="55552.html">55552</a> (first character in the number string)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30380"></a>30380</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick up a character from the number string</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30381"></a>30381</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Have we reached the end of the string?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30382"></a>30382</td>
<td class="instruction">JR NZ,30386</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30384"></a>30384</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30385"></a>30385</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30386"></a>30386</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Move to the next character in the number string</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30387"></a>30387</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30388"></a>30388</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L'</span>=ASCII code for a digit of the number (48-57)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30389"></a>30389</td>
<td class="instruction">LD H,217</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at the start of the font data for this digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30391"></a>30391</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the pixel width in <span class="register">B'</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30392"></a>30392</td>
<td class="instruction">INC B</td>
<td class="comment-11" rowspan="1">Add 1 for left padding</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30393"></a>30393</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">An empty byte for left padding</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30394"></a>30394</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at the next bitmap byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30395"></a>30395</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30396"></a>30396</td>
<td class="instruction">CALL <a class="link" href="30258.html">30258</a></td>
<td class="comment-11" rowspan="1">Slide the bitmap byte into the buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30399"></a>30399</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30400"></a>30400</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the next bitmap byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30401"></a>30401</td>
<td class="instruction">DJNZ 30394</td>
<td class="comment-11" rowspan="1">Jump back until all bitmap bytes are done</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30403"></a>30403</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30404"></a>30404</td>
<td class="instruction">JR 30380</td>
<td class="comment-11" rowspan="1">Jump back to collect the next digit</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30276.html">30276</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30278">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="30406.html">30406</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Skool Daze RAM disassembly 20140614</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd (Skool Daze). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>
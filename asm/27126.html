<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Skool Daze: Routine at 27126</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../sd.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Skool Daze" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="27125.html">27125</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#27126">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="27191.html">27191</a></span></td>
</tr>
</table>
<div class="description">27126: Make a little boy trip people up</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this continual subcommand routine is placed into bytes 124 and 125 of little boy no. 1's character buffer by the routine at <a class="link" href="27246.html">27246</a>, and into bytes 124 and 125 of the character buffers of little boys 2-11 by the routine at <a class="link" href="27266.html">27266</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Little boy's character number (152-162)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="27126"></a>27126</td>
<td class="instruction">LD L,97</td>
<td class="comment-11" rowspan="2">Pick up the little boy's y-coordinate in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27128"></a>27128</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27129"></a>27129</td>
<td class="instruction">CALL <a class="link" href="26184.html#26185">26185</a></td>
<td class="comment-11" rowspan="1">Is the boy on a staircase?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27132"></a>27132</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27133"></a>27133</td>
<td class="instruction">LD B,10</td>
<td class="comment-11" rowspan="1">We will check characters 163-172 (teachers and main kids)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27135"></a>27135</td>
<td class="instruction">LD DE,41826</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=163 (MR WACKER), <span class="register">E</span>=98</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27138"></a>27138</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27139"></a>27139</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="27140"></a>27140</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=little boy's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27141"></a>27141</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does this teacher's or main kid's x-coordinate match?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27142"></a>27142</td>
<td class="instruction">JR Z,27149</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="27144"></a>27144</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Next teacher or main kid</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27145"></a>27145</td>
<td class="instruction">DJNZ 27140</td>
<td class="comment-11" rowspan="1">Jump back until all teachers and main kids have been checked</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27147"></a>27147</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27148"></a>27148</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="27149"></a>
<div class="comments">
<div class="paragraph">
A teacher or main kid is at the same x-coordinate as the little boy. Now check the y-coordinates.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="27149"></a>27149</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="2"><span class="register">E</span>=<span class="register">L</span>=97</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27150"></a>27150</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27151"></a>27151</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=little boy's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27152"></a>27152</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=98</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27153"></a>27153</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does this teacher's or main kid's y-coordinate match?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27154"></a>27154</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=98</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27155"></a>27155</td>
<td class="instruction">JR NZ,27144</td>
<td class="comment-11" rowspan="1">Consider the next teacher or main kid if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="27157"></a>
<div class="comments">
<div class="paragraph">
A teacher or main kid is at the same location as the little boy.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27157"></a>27157</td>
<td class="instruction">LD L,112</td>
<td class="comment-11" rowspan="2">Bytes 111 and 112 of the character's buffer may hold a routine address; pick up the MSB in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27159"></a>27159</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27160"></a>27160</td>
<td class="instruction">LD L,98</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27162"></a>27162</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is there an uninterruptible subcommand routine address in bytes 111 and 112?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27163"></a>27163</td>
<td class="instruction">JR NZ,27144</td>
<td class="comment-11" rowspan="1">Consider the next teacher or main kid if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27165"></a>27165</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=number of the character in the same location as the little boy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27166"></a>27166</td>
<td class="instruction">CP 172</td>
<td class="comment-11" rowspan="1">Is it ERIC?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27168"></a>27168</td>
<td class="instruction">JR Z,27184</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27170"></a>27170</td>
<td class="instruction">LD L,111</td>
<td class="comment-11" rowspan="4">Place the address of the uninterruptible subcommand routine at <a class="link" href="27206.html">27206</a> into bytes 111 and 112 of the teacher's or main kid's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27172"></a>27172</td>
<td class="instruction">LD (HL),70</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27174"></a>27174</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27175"></a>27175</td>
<td class="instruction">LD (HL),106</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27177"></a>27177</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Initialise the timing parameter in byte 113 of the character's buffer (which determines how long the character will stay down)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27178"></a>27178</td>
<td class="instruction">LD (HL),20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27180"></a>27180</td>
<td class="instruction">LD L,98</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27182"></a>27182</td>
<td class="instruction">JR 27144</td>
<td class="comment-11" rowspan="1">Consider the next teacher or main kid</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="27184"></a>
<div class="comments">
<div class="paragraph">
ERIC is in the same location as the little boy. Knock ERIC out.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="27184"></a>27184</td>
<td class="instruction">LD HL,32763</td>
<td class="comment-11" rowspan="1"><a class="link" href="32763.html">32763</a> holds ERIC's status flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27187"></a>27187</td>
<td class="instruction">SET 4,(HL)</td>
<td class="comment-11" rowspan="1">Signal: ERIC has been knocked out</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27189"></a>27189</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="27190"></a>27190</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="27125.html">27125</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#27126">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="27191.html">27191</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Skool Daze RAM disassembly 20150413</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd (Skool Daze). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>
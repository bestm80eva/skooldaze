<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Skool Daze: Routine at 29442</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../skool.css" />
<link rel="stylesheet" type="text/css" href="../sd.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="29441.html">29441</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#29442">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="29513.html">29513</a></span></td>
</tr>
</table>
<div class="description">29442: Slide a message character into the speech bubble text window (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Continues from the routine at <a class="link" href="29706.html">29706</a>. Returns with the carry flag set if the speech bubble is off-screen.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">ASCII code of the character</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29442"></a>29442</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=ASCII code of the character from the message being spoken</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29443"></a>29443</td>
<td class="instruction">LD A,(32612)</td>
<td class="comment-11" rowspan="1">Copy the speech bubble lip x-coordinate from <a class="link" href="32612.html">32612</a> to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29446"></a>29446</td>
<td class="instruction">AND 120</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=x-coordinate of the right edge of the text window within the speech bubble</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29448"></a>29448</td>
<td class="instruction">ADD A,6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29450"></a>29450</td>
<td class="instruction">LD HL,32512</td>
<td class="comment-11" rowspan="1"><a class="link" href="32512.html">32512</a> holds the leftmost column of the skool on screen (0-64)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29453"></a>29453</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="2">Return with the carry flag set if the speech bubble is off-screen to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29454"></a>29454</td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29455"></a>29455</td>
<td class="instruction">CP 32</td>
<td class="comment-11" rowspan="3">Return with the carry flag set if the speech bubble is off-screen to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29457"></a>29457</td>
<td class="instruction">CCF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29458"></a>29458</td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29459"></a>
<div class="comments">
<div class="paragraph">
The speech bubble is on screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29459"></a>29459</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1"><span class="register">C</span>=screen x-coordinate of the right edge of the text window within the speech bubble (6, 14, 22 or 30)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29460"></a>29460</td>
<td class="instruction">LD A,(32613)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=y-coordinate of the speech bubble lip</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29463"></a>29463</td>
<td class="instruction">SUB 154</td>
<td class="comment-11" rowspan="2"><span class="register">D</span>=screen y-coordinate of the top row of the speech bubble (0-17)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29465"></a>29465</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29466"></a>29466</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="10">Set <span class="register">HL</span> to the display file address corresponding to the top right edge of the text window within the speech bubble</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29467"></a>29467</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29468"></a>29468</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29469"></a>29469</td>
<td class="instruction">AND 224</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29471"></a>29471</td>
<td class="instruction">ADD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29472"></a>29472</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29473"></a>29473</td>
<td class="instruction">LD A,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29474"></a>29474</td>
<td class="instruction">AND 24</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29476"></a>29476</td>
<td class="instruction">ADD A,68</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29478"></a>29478</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29479"></a>29479</td>
<td class="instruction">LD D,217</td>
<td class="comment-11" rowspan="3"><span class="register">C</span>=width (in pixels) of the message character bitmap</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29481"></a>29481</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29482"></a>29482</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29483"></a>
<div class="comments">
<div class="paragraph">
Now we enter a loop to slide the pixel columns of the message character bitmap into the text window of the speech bubble.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29483"></a>29483</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=next pixel column of the message character bitmap</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29484"></a>29484</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29485"></a>29485</td>
<td class="instruction">CALL 29491</td>
<td class="comment-11" rowspan="1">Slide this into the speech bubble text window</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29488"></a>29488</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Next pixel column</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29489"></a>29489</td>
<td class="instruction">JR NZ,29483</td>
<td class="comment-11" rowspan="1">Jump back until all pixel columns are done</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29491"></a>29491</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Store the display file address temporarily</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29492"></a>29492</td>
<td class="instruction">CALL <a class="link" href="32216.html">32216</a></td>
<td class="comment-11" rowspan="1">Slide the top four pixel rows of the text window one pixel to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29495"></a>29495</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Store the message character pixel column in <span class="register">B</span> temporarily</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29496"></a>29496</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="7">Set <span class="register">HL</span> to the display file address corresponding to the fifth pixel row down from the top right edge of the text window within the speech bubble</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29497"></a>29497</td>
<td class="instruction">ADD A,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29499"></a>29499</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29500"></a>29500</td>
<td class="instruction">JR C,29506</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29502"></a>29502</td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29503"></a>29503</td>
<td class="instruction">SUB 8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29505"></a>29505</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29506"></a>29506</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Restore the message character pixel column to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29507"></a>29507</td>
<td class="instruction">CALL <a class="link" href="32216.html">32216</a></td>
<td class="comment-11" rowspan="1">Slide the bottom four pixel rows of the text window one pixel to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29510"></a>29510</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the display file address to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29511"></a>29511</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">Reset the carry flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29512"></a>29512</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="29441.html">29441</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#29442">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="29513.html">29513</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Skool Daze RAM disassembly 20140614</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd (Skool Daze). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>
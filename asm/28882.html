<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Skool Daze: Routine at 28882</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../skool.css" />
<link rel="stylesheet" type="text/css" href="../sd.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="28807.html">28807</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#28882">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="28960.html">28960</a></span></td>
</tr>
</table>
<div class="description">28882: Get the next character of a message being spoken or written</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="28994.html">28994</a> and <a class="link" href="29706.html">29706</a>. Returns with the next character in <span class="register">A</span>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Number of the character speaking or writing (152-169)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28882"></a>28882</td>
<td class="instruction">LD L,110</td>
<td class="comment-11" rowspan="2">Bytes 109 and 110 of the character's buffer hold the address of the next character in the submessage</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28884"></a>28884</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28885"></a>28885</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Are we in a submessage at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28886"></a>28886</td>
<td class="instruction">JR Z,28904</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28888"></a>28888</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="3"><span class="register">DE</span>=address of the next character in the submessage</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28889"></a>28889</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28890"></a>28890</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28891"></a>28891</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick up this character in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28892"></a>28892</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has the submessage finished?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28893"></a>28893</td>
<td class="instruction">JR Z,28901</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28895"></a>28895</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28896"></a>28896</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="4">Move to the next character in the submessage, and store its address in bytes 109 and 110 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28897"></a>28897</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28898"></a>28898</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28899"></a>28899</td>
<td class="instruction">LD (HL),D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28900"></a>28900</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="28901"></a>
<div class="comments">
<div class="paragraph">
The submessage has finished.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28901"></a>28901</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="3">Zero out bytes 109 and 110 of the character's buffer to indicate that the submessage is finished</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28902"></a>28902</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28903"></a>28903</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="28904"></a>
<div class="comments">
<div class="paragraph">
We are dealing with the main message.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28904"></a>28904</td>
<td class="instruction">LD L,108</td>
<td class="comment-11" rowspan="4"><span class="register">DE</span>=address of the next character in the main message (collected from bytes 107 and 108 of the character's buffer)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28906"></a>28906</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28907"></a>28907</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28908"></a>28908</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28909"></a>28909</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick up the next character of the message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28910"></a>28910</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="4">Move to the next character in the main message, and store its address in bytes 107 and 108 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28911"></a>28911</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28912"></a>28912</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28913"></a>28913</td>
<td class="instruction">LD (HL),D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28914"></a>28914</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=109</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28915"></a>28915</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-11" rowspan="1">Is the ASCII code of the next character &lt; 128?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28917"></a>28917</td>
<td class="instruction">JR Z,28938</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="28919"></a>
<div class="comments">
<div class="paragraph">
The ASCII code of the next character is &gt;= 128, which refers to an entry in one of the symbol/element, capital city/country and date/battle question-and-answer pairs.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28919"></a>28919</td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="13">Set <span class="register">DE</span> to <a class="link" href="57088.html">57088</a>+12*(<span class="register">A</span>-128)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28921"></a>28921</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28922"></a>28922</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28923"></a>28923</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28924"></a>28924</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28925"></a>28925</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28926"></a>28926</td>
<td class="instruction">LD H,56</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28928"></a>28928</td>
<td class="instruction">JR NC,28931</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28930"></a>28930</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28931"></a>28931</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28932"></a>28932</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28933"></a>28933</td>
<td class="instruction">DEC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28934"></a>28934</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28935"></a>28935</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="2">Pick up the first character of this submessage in <span class="register">A</span> and store the next address in bytes 109 and 110 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28936"></a>28936</td>
<td class="instruction">JR 28896</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="28938"></a>
<div class="comments">
<div class="paragraph">
The ASCII code of the next character in the message is &lt; 128.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28938"></a>28938</td>
<td class="instruction">CP 32</td>
<td class="comment-11" rowspan="2">Return if the next character is a normal, printable character (ASCII code &gt;= 32)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28940"></a>28940</td>
<td class="instruction">RET NC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28941"></a>28941</td>
<td class="instruction">CP 16</td>
<td class="comment-11" rowspan="2">Return if the ASCII code of the next character in the message is &lt; 16</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28943"></a>28943</td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="28944"></a>
<div class="comments">
<div class="paragraph">
The ASCII code of the next character in the message is 16-24. We have a submessage to deal with, which will be one of the following:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th>Code</th>
<th>Address</th>
<th>Submessage</th>
</tr>
<tr>
<td class="centre">16</td>
<td class="centre"><a class="link" href="55680.html">55680</a></td>
<td>'ERIC'</td>
</tr>
<tr>
<td class="centre">17</td>
<td class="centre"><a class="link" href="55694.html">55694</a></td>
<td>'BOY WANDER'</td>
</tr>
<tr>
<td class="centre">18</td>
<td class="centre"><a class="link" href="55708.html">55708</a></td>
<td>'ANGELFACE'</td>
</tr>
<tr>
<td class="centre">19</td>
<td class="centre"><a class="link" href="55722.html">55722</a></td>
<td>'EINSTEIN'</td>
</tr>
<tr>
<td class="centre">20</td>
<td class="centre"><a class="link" href="55736.html">55736</a></td>
<td>'MR WACKER'</td>
</tr>
<tr>
<td class="centre">21</td>
<td class="centre"><a class="link" href="55750.html">55750</a></td>
<td>'MR ROCKITT'</td>
</tr>
<tr>
<td class="centre">22</td>
<td class="centre"><a class="link" href="55764.html">55764</a></td>
<td>'MR WITHIT'</td>
</tr>
<tr>
<td class="centre">23</td>
<td class="centre"><a class="link" href="55778.html">55778</a></td>
<td>'MR CREAK'</td>
</tr>
<tr>
<td class="centre">24</td>
<td class="centre"><a class="link" href="55792.html">55792</a></td>
<td>'Please Sir - I cannot tell a lie . . '</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28944"></a>28944</td>
<td class="instruction">SUB 16</td>
<td class="comment-11" rowspan="10">Point <span class="register">DE</span> at the appropriate submessage from the table above</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28946"></a>28946</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28947"></a>28947</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28948"></a>28948</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28949"></a>28949</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28950"></a>28950</td>
<td class="instruction">SUB E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28951"></a>28951</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28952"></a>28952</td>
<td class="instruction">ADD A,128</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28954"></a>28954</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28955"></a>28955</td>
<td class="instruction">LD D,217</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28957"></a>28957</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick up the first character of the submessage in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28958"></a>28958</td>
<td class="instruction">JR 28896</td>
<td class="comment-11" rowspan="1">Store the address of the next character in the submessage</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="28807.html">28807</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#28882">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="28960.html">28960</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Skool Daze RAM disassembly 20140614</div>
<div class="copyright">&#169; 1984 Microsphere Computer Services Ltd (Skool Daze). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>